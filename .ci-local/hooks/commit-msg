#!/bin/bash
set -e
# =============================================================================
# COMMIT-MSG: Validate commit message
# =============================================================================
# Bloquea mensajes con atribuci√≥n a IA
# =============================================================================

COMMIT_MSG_FILE="$1"
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# Patrones prohibidos en mensaje de commit (case insensitive)
AI_PATTERNS=(
    "co-authored-by:.*claude"
    "co-authored-by:.*anthropic"
    "co-authored-by:.*gpt"
    "co-authored-by:.*openai"
    "co-authored-by:.*copilot"
    "co-authored-by:.*gemini"
    "co-authored-by:.*\bai\b"
    "made by claude"
    "made by gpt"
    "made by ai"
    "made with claude"
    "made with ai"
    "generated by claude"
    "generated by gpt"
    "generated by ai"
    "generated with claude"
    "generated with ai"
    "written by claude"
    "written by ai"
    "created by claude"
    "created by ai"
    "assisted by claude"
    "assisted by ai"
    "with help from claude"
    "claude code"
    "claude opus"
    "claude sonnet"
    "claude haiku"
    "gpt-4"
    "gpt-3"
    "chatgpt"
    "@anthropic.com"
    "@openai.com"
    "noreply@anthropic"
    "noreply@openai"
)

for pattern in "${AI_PATTERNS[@]}"; do
    if echo "$COMMIT_MSG" | grep -iqE "$pattern"; then
        echo -e ""
        echo -e "${RED}COMMIT BLOCKED: AI Attribution Detected${NC}"
        echo -e ""
        echo -e "${RED}Found in commit message: ${NC}"
        echo -e "${YELLOW}  Pattern: $pattern${NC}"
        echo -e ""
        echo -e "${RED}Your commit message:${NC}"
        echo -e "${YELLOW}$(cat "$COMMIT_MSG_FILE")${NC}"
        echo -e ""
        echo -e "${GREEN}Remove AI attribution. You are the sole author.${NC}"
        echo -e ""
        exit 1
    fi
done

# Mensaje OK
exit 0
